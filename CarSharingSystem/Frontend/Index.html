<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Car Sharing System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f7f8;
            color: #333;
            margin: 0;
            padding: 0;
        }

        header {
            background: #0078d7;
            color: #fff;
            padding: 1rem;
            text-align: center;
        }

        section {
            max-width: 900px;
            margin: 2rem auto;
            background: #fff;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        input, button {
            padding: 0.5rem;
            margin: 0.3rem 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            width: 100%;
        }

        button {
            background: #0078d7;
            color: white;
            cursor: pointer;
        }

            button:hover {
                background: #005a9e;
            }

        .car-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
            background: #fafafa;
        }
    </style>
</head>
<body>
    <header><h1>Car Sharing System</h1></header>

    <section id="login-section">
        <h2>🔑 Logowanie</h2>
        <input type="email" id="email" placeholder="Email" />
        <input type="password" id="password" placeholder="Hasło" />
        <button onclick="login()">Zaloguj się</button>
        <button onclick="register()">Zarejestruj się</button>
        <p id="login-status"></p>
    </section>

    <section id="cars-section" style="display:none;">
        <h2>🚗 Dostępne samochody</h2>
        <div id="cars"></div>
    </section>

    <script>
    const apiUrl = "https://localhost:7112/api";
    let token = "";

    async function register() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const name = email.split("@")[0];
      const res = await fetch(`${apiUrl}/users/register`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, email, password })
      });
      if (res.ok) alert("✅ Zarejestrowano! Teraz się zaloguj.");
      else alert("❌ Błąd rejestracji.");
    }

    async function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const res = await fetch(`${apiUrl}/users/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password })
      });
      if (!res.ok) return alert("❌ Błędne dane logowania.");

      const data = await res.json();
      token = data.token;
      document.getElementById("login-status").textContent = "Zalogowano!";
      document.getElementById("login-section").style.display = "none";
      document.getElementById("cars-section").style.display = "block";
      loadCars();
    }

    async function loadCars() {
      const res = await fetch(`${apiUrl}/cars/available`, {
        headers: { Authorization: `Bearer ${token}` }
      });
      const cars = await res.json();
      const list = document.getElementById("cars");
      list.innerHTML = "";
      cars.forEach(c => {
        const div = document.createElement("div");
        div.className = "car-card";
        div.innerHTML = `
          <b>${c.brand} ${c.model}</b><br>
          Typ: ${c.carType} | Cena: ${c.pricePerDay} zł/dzień<br>
          <button onclick="reserve('${c.carId}')">Rezerwuj</button>
        `;
        list.appendChild(div);
      });
    }

    async function reserve(carId) {
      const start = new Date();
      const end = new Date();
      end.setDate(start.getDate() + 1);
      const res = await fetch(`${apiUrl}/reservations/create`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`
        },
        body: JSON.stringify({
          carId,
          startRental: start.toISOString(),
          endRental: end.toISOString(),
          methodOfPayment: "CreditCard"
        })
      });
      if (res.ok) alert("🚘 Rezerwacja utworzona!");
      else alert("❌ Nie udało się zarezerwować.");
    }
    </script>
</body>
</html>
